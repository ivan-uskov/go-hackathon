<!DOCTYPE html>
<html lang="en">
<head>
    <title>Go хакатон</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous" defer></script>
</head>
<body>
    <div class="container ms-auto pt-5">
        <h1>Go хакатон</h1>
        <table class="table mt-5">
            <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Score</th>
                <th scope="col">Created At</th>
            </tr>
            </thead>
            <tbody id="tableBody">

            <tr>
                <td id="preloader" colspan="3" class="text-center pt-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <script type="text/javascript">
        class TableBuilder {
            constructor(tableId) {
                this.table = document.getElementById(tableId);
            }

            updateTable(data) {
                let content = "";
                data.map(item => {
                   content += this._buildRow(item['name'], item['score'], item['created_at']);
                });

                this.table.innerHTML = content;
            }

            _buildRow(name, score, createdAt) {
                return "<tr>\n" +
                    "<th scope=\"row\">" + name + "</th>\n" +
                    "<td>" + score + "</td>\n" +
                    "<td>" + createdAt + "</td>\n" +
                    "</tr>";
            }
        }

        class TableLoader {
            constructor(loadUrl, loadHandler) {
                this.loadUrl = loadUrl;
                this.loadHandler = loadHandler;
            }

            startLoadingCycle(timeout) {
                this._load();
                setInterval(this._load.bind(this), timeout);
            }

            _load() {
                return fetch(this.loadUrl)
                    .then(response => response.json())
                    .then(data => this.loadHandler(data));
            }
        }

        window.onload = () => {
            const AddUrl = "{{ .AddUrl }}";
            const LoadUrl = "{{ .LoadUrl }}";

            const builder = new TableBuilder("tableBody");
            const loader = new TableLoader(LoadUrl, builder.updateTable.bind(builder));

            loader.startLoadingCycle(3000);
        }
    </script>
</body>
</html>